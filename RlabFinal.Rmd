---
title: "RlabFinal"
author: "Shilpi Jaiswal"
date: "March 16, 2016"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r  message=FALSE}

library("dplyr")  #for dplyr
library("RSQLite") #for sqllite
library("nycflights13") #for data
library(ggplot2)

my.db <- nycflights13_sqlite()

```

```{r, message=FALSE, echo=T}

weather.df  <- weather %>% collect()
planes.df  <- planes %>% collect()
flights.df <- tbl(my.db, "flights") %>% 
                 collect() %>%
                 
                  mutate(
                       
                     cancelled = ifelse(is.na(arr_time), 1, 0), # 151 cancellations
                     delayed =  ifelse(dep_delay > 0, 1, 0),
                     date = paste(year, month, day, sep = "-"),
                     date = as.Date(date, "%Y-%m-%d")
                  )

```


```{r, echo=FALSE}

weather.df <- weather.df %>%
             mutate(
                  
                  date = paste(year, month, day, sep = "-"),
                  date = as.Date(date, "%Y-%m-%d")
   
             )
```


```{r, echo=T}

flt.plane <- flights.df %>% 
              left_join(planes.df, by = "tailnum")

flt.plane.w <- flt.plane %>% inner_join(weather.df, by = "date")  %>% 
      select(-year.x, -month.x, -day.x, -precip, -hour.x, -hour.y, -manufacturer,-type, -speed)

```


```{r, echo=FALSE, fig.height = 3., fig.width=6, message=FALSE, fig.cap = "Density plot Dew Point, on Cancelled flights"}
# Analysis on weather
ggplot(flt.plane.w, aes(x = dewp, y = ..density.., fill = visib)) + 
  geom_histogram(binwidth = 1) +
  facet_grid(cancelled ~ .)

```


```{r, echo=FALSE, message=FALSE, fig.cap = "Density plot Dew Point, on Delayed flights"}
# Analysis on weather
 ggplot(flt.plane.w, aes(x = dewp, y = ..density.., fill = visib)) + 
  geom_histogram(binwidth = 1) +
  facet_grid(delayed ~ .)

```



```{r, echo=F}

 # Analysis on aspect of time

time_analysis <- flt.plane.w %>% group_by(year.y, month.y, day.y) %>%
  mutate(
    
    rw.median = median(dep_delay, na.rm = T),
    count = n()
  ) %>% 
  select(year.y, month.y,day.y, date, rw.median, delayed) %>%
  arrange(year.y, month.y, day.y)

```


```{r, echo=FALSE, message=FALSE, fig.cap = "Plot of median departure delay"}

plot2b <- ggplot(time_analysis, aes( x = date, y = rw.median)) + 
  geom_line(aes(color = rw.median), size = 1.05)
plot2b


```